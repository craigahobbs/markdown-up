# Licensed under the MIT License
# https://github.com/craigahobbs/markdown-up/blob/main/LICENSE

include <unittest.bare>
include <unittestMock.bare>


# Start coverage
coverageStart()

# Save the originals
dataTableOriginal = systemGlobalGet('dataTable')
markdownPrintOriginal = systemGlobalGet('markdownPrint')
elementModelRenderOriginal = systemGlobalGet('elementModelRender')

# Include the local markdownUp.bare
include '../markdownUp.bare'

# Save the markdownPrint stub and restore the original markdownPrint
markdownPrintStub = systemGlobalGet('markdownPrint')
if markdownPrintOriginal:
    markdownPrint = markdownPrintOriginal
endif

# Run markdownUp.bare unit tests
include 'testMarkdownUp.bare'

# Stop coverage
coverageStop()

# Restore the remaining orignals
if dataTableOriginal:
    dataTable = dataTableOriginal
endif
if elementModelRenderOriginal:
    elementModelRender = elementModelRenderOriginal
endif

# Test report
return unittestReport({ \
    'title': 'markdownUp.bare Tests', \
    'links': ['[MarkdownUp Include Library Tests](#url=&var=)'], \
    'coverageExclude': ['runTestsMarkdownUp.bare'], \
    'coverageMin': 100 \
})
